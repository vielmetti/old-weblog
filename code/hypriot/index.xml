<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Hypriot on Vacuum weblog from Edward Vielmetti</title>
    <link>http://vielmetti.github.io/code/hypriot/</link>
    <description>Recent content in Hypriot on Vacuum weblog from Edward Vielmetti</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 11 Jul 2016 13:30:00 -0400</lastBuildDate>
    <atom:link href="http://vielmetti.github.io/code/hypriot/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>full stack plane spotting and data analysis</title>
      <link>http://vielmetti.github.io/post/2016/2016-07-11-full-stack-plane-spotting/</link>
      <pubDate>Mon, 11 Jul 2016 13:30:00 -0400</pubDate>
      
      <guid>http://vielmetti.github.io/post/2016/2016-07-11-full-stack-plane-spotting/</guid>
      <description>

&lt;p&gt;The task at hand is simple. Whenever a particular airplane is visible overhead,
send out a tweet with that notice. Don&amp;rsquo;t repeat yourself with this announcement
more than twice an hour, but try not to have too much lag in reporting.&lt;/p&gt;

&lt;p&gt;The full stack of hardware and software to do this is not particularly
complicated to use once you get it all running, but there are a series
of issues and observations along the way that add to the complexity. I&amp;rsquo;ll
walk through the whole thing start to finish, and let you know where I
left off.&lt;/p&gt;

&lt;h2 id=&#34;plane-spotting:984b95b4570fb7d5b37f67357af2ada0&#34;&gt;Plane spotting&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://vielmetti.github.io/post/2016/2016-07-02-plane-finding-with-dump1090/&#34;&gt;When last I wrote&lt;/a&gt;,
I had &lt;a href=&#34;http://github.com/mutability/dump1090&#34;&gt;dump1090&lt;/a&gt;
running on my MacBook. Since then, I&amp;rsquo;ve taken the same software and gotten
the latest dev release going on a Raspberry Pi 2.&lt;/p&gt;

&lt;p&gt;I switched to a smaller, simpler antenna, and the result was positive: instead of
having a 40 to 50 nautical mile range, now I&amp;rsquo;m in the 60 to 65 nm range (about 110 km).
It might also help that the Pi 2 is not really doing very much else. That
particular Pi 2 setup is using a slightly back-rev version of the
&lt;a href=&#34;http://blog.hypriot.com&#34;&gt;Hypriot&lt;/a&gt; software for the Pi, so it has all
of the modern conveniences plus an instance of Docker on board. The
temptation was to Dockerize everything, but I haven&amp;rsquo;t gone there yet;
the available Docker prebuilt releases don&amp;rsquo;t have the bleeding edge of
the dump1090-mutability code, and I want to see how the whole thing runs
native for a while before containerizing it.&lt;/p&gt;

&lt;p&gt;The snag that slowed down this deployment a little was Google&amp;rsquo;s decision
to enforce an API key for personal use of Google Maps. In response, the
very latest dump1090-mutability pulled out its Google Maps support, and
went to &lt;a href=&#34;http://openlayers.org/&#34;&gt;OpenLayers&lt;/a&gt;. This new support gives
access to all kinds of base maps, including some aviation-specific
charts. (&amp;ldquo;Not for use in navigation.&amp;rdquo;)&lt;/p&gt;

&lt;p&gt;Another piece of this was bringing up &lt;a href=&#34;http://www.lighttpd.net/&#34;&gt;lighttpd&lt;/a&gt;
(&amp;ldquo;lighty&amp;rdquo;), a lightweight HTTP server that replaces the rickety
built-in HTTP server that dump1090 had originally shipped with.
Configuration following the supplied instructions was simple,
and lighttpd looks like a very suitable system to put in place to
serve HTTP on embedded-class system that need flexiblity but not
a big footprint.&lt;/p&gt;

&lt;p&gt;The other component in the Pi setup is an ADS-B feed to the excellent
&lt;a href=&#34;Planefinder&#34;&gt;http://planefinder.net&lt;/a&gt; site. Planefinder provides a Debian
package for setting up the feed, and it runs neatly with only a minimum
of overhead.&lt;/p&gt;

&lt;p&gt;The Pi does not yet have a working OpenVPN configuration, so I can&amp;rsquo;t get
to it over the net directly. For that I plan to revisit the
&lt;a href=&#34;http://vielmetti.github.io/post/2015/2015-09-07-managing-raspberry-pi-openvpn-with-salt/&#34;&gt;SaltStack for Pi&lt;/a&gt;
configuration I wrote up last September. In the interim, salt has
been upgraded, and perhaps it will be a little more stable over bad
connections; we&amp;rsquo;ll see.&lt;/p&gt;

&lt;h2 id=&#34;data-analysis:984b95b4570fb7d5b37f67357af2ada0&#34;&gt;Data analysis&lt;/h2&gt;

&lt;p&gt;dump1090 provides a data feed in a convenient JSON format, available
through a URL on a standard configuruation. The ADS-B messages themselves
are binary encoded, but the system brings them into JSON so that all
of the downstream processing is very easy.&lt;/p&gt;

&lt;p&gt;Data handling is so straightforward that you can do it all without
needing any special-purpose processing nodes in IBM&amp;rsquo;s &lt;a href=&#34;http://nodered.org&#34;&gt;Node-RED&lt;/a&gt;.
A standard HTTP in node polls the data at the pace that you choose,
and a simple function pulls apart the record of all planes into
individual records for each plane.&lt;/p&gt;

&lt;p&gt;Getting Node-RED running is continuing to get easier over time.
I&amp;rsquo;m doing prototyping work on my Macintosh again, using the
new &lt;a href=&#34;https://blog.docker.com/2016/06/docker-mac-windows-public-beta/&#34;&gt;Docker for Mac&lt;/a&gt;
setup to pick up a &lt;a href=&#34;https://hub.docker.com/r/cpswan/node-red/&#34;&gt;Node-RED container&lt;/a&gt;
to do the work in. &lt;a href=&#34;https://kitematic.com/&#34;&gt;Kitematic&lt;/a&gt; comes with Docker for Mac,
providing a convenient dashboard and interface to Docker Hub.&lt;/p&gt;

&lt;p&gt;(Do note, however, that if you got Docker for Mac running a few months
ago, you&amp;rsquo;ll need to go through a rebuild process to go to the latest
beta. To &lt;a href=&#34;https://docs.docker.com/docker-for-mac/troubleshoot/#/recreate-or-update-your-containers-after-beta-18-upgrade&#34;&gt;recreate or update your containers after Beta 18 upgrade&lt;/a&gt;
follow the provided instructions.)&lt;/p&gt;

&lt;p&gt;Once you have both Node-RED and dump1090 running, connecting the
two together is straightforward. I started with this
&lt;a href=&#34;https://gist.github.com/dceejay/3288996fefdc3aef04846496277b6444&#34;&gt;gist from dceejay&lt;/a&gt; which
provides the basic flow and feeds into a
&lt;a href=&#34;http://flows.nodered.org/node/node-red-contrib-web-worldmap&#34;&gt;worldmap node&lt;/a&gt; that
is a general programmable interface for putting things on a map. My
&lt;a href=&#34;https://gist.github.com/vielmetti/6329ea5a49dadd2f106980a20727d16e&#34;&gt;updated dump1090 gist for Node-RED&lt;/a&gt;
adapts the data for a slightly different format between dump1090 forks.&lt;/p&gt;

&lt;p&gt;From here in it&amp;rsquo;s relatively clear sailing. Set up a flow downstream
from the plane messages, using a filter node to match the name or
ICAO hex code of the airplane that you want to track. Wire it through
a delay filter to set the frequency of messages you want to
allow through, and a formatting node to pretty up the message in
a form suitable for Twitter output.&lt;/p&gt;

&lt;h2 id=&#34;incomplete-image-and-next-steps:984b95b4570fb7d5b37f67357af2ada0&#34;&gt;Incomplete image and next steps.&lt;/h2&gt;

&lt;p&gt;This is a relatively complex stack, but it all fits neatly on a Raspberry Pi 2,
and with a little bit more elbow grease it should be possible to containerize
everything so that it Just Works and can be made to reliably work again.&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;d like to have OpenVPN running on the Pi 2, but it isn&amp;rsquo;t yet, pending
rework of Salt to get that to a current version and to port all of the
work I did from an earlier version.&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;m picking up planes from 60+ nm away, but I know that with a better
antenna, bandpass filter, and amplifier that I can do better.
&lt;a href=&#34;https://puck.nether.net/~jared/blog/?p=160&#34;&gt;Jared Mauch&amp;rsquo;s parts list&lt;/a&gt;
would be the place to go for starters with a very modest budget of
a couple of hundred bucks.&lt;/p&gt;

&lt;p&gt;Reception is best i fyou have a clear view of the sky, which suggests
an outdoors installation, powering the Pi with power over ethernet.&lt;/p&gt;

&lt;p&gt;The system is running on a Pi 2, but reports from Jared and from Phil Karn KA9Q
suggest that if you do upgrade the reception that it&amp;rsquo;s possible to
saturate the Pi 2. Fortunately a Pi 3 does even better at the intended task.&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;m still figuring out what the very best way to create a Docker image
that handles Node-RED, especially the installation of additional nodes
and the management of flows. You&amp;rsquo;d like to have the whole thing suitably
tidy that it could be all loaded in from the get-go.&lt;/p&gt;

&lt;p&gt;dump1090-mutability is still mutating! It&amp;rsquo;s under active development,
both at the presentation layer and at the decoder layer. So it would
be appropriate to have the attitude for at least one development machine
to be sure that you were ready to rebuild from source whenever.&lt;/p&gt;

&lt;p&gt;If you only have half of this stack running (the Node-RED side) but no access
to radios, you can find an existing dump1090 installation and pull the
JSON from there. This is best done only via prior arrangement and only
for testing purposes or for specific tasks. It&amp;rsquo;s easy to crank up Node-RED
to poll a URL every second; don&amp;rsquo;t do that to a poor little Pi.&lt;/p&gt;

&lt;p&gt;The planes I want to watch don&amp;rsquo;t take off very often - that&amp;rsquo;s the appeal
of watching for them.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Bringing up Node-RED and mosquitto under &#34;docker compose&#34; on a Raspberry Pi</title>
      <link>http://vielmetti.github.io/post/2015/2015-07-13-bringing-up-node-red-and-mosquitto-under-docker-compose-on-a-raspberry-pi/</link>
      <pubDate>Mon, 13 Jul 2015 02:18:01 -0400</pubDate>
      
      <guid>http://vielmetti.github.io/post/2015/2015-07-13-bringing-up-node-red-and-mosquitto-under-docker-compose-on-a-raspberry-pi/</guid>
      <description>&lt;p&gt;Progress, actually quite a lot of it:&lt;/p&gt;

&lt;p&gt;The problem, neatly stated. Docker is good for bringing up single services (&#34;microservices&#34;), but sometimes your application needs more than one thing running for the whole thing to work. Enter &#34;docker compose&#34;, formerly &#34;fig&#34;, which automates the process of running various Docker commands in the right order with the right arguments all driven from a configuration file. As described by their documentation:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Compose is a tool for defining and running complex applications with Docker. With Compose, you define a multi-container application in a single file, then spin your application up in a single command which does everything that needs to be done to get it running.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The particular task I have in front of me is launching Node-RED and mosquitto (an MQTT broker) together on a Raspberry Pi 2 which is running Hypriot and Docker. Most of the background for &lt;em&gt;why&lt;/em&gt; that&#39;s a relevant task is at this post on Hypriot, &lt;a href=&#34;http://blog.hypriot.com/post/docker-compose-nodejs-haproxy/&#34;&gt;How to use Docker Compose to run complex multi container apps on your Raspberry Pi&lt;/a&gt;, which I dutifully and successfully managed to run all of the examples from. &lt;/p&gt;

&lt;p&gt;Emboldened by this I tried to get Wordpress running with MySQL but got stuck because of a variety of things (not the least of which was some over-enthusiastic documentation that downplayed the complexity of that task, and the lack of a Pi-specific Wordpress Docker images). But having had the taste of what might be I carried on until I managed to get something to work for what I really wanted: Node-RED running alongside mosquitto so that I could have a local MQTT broker to talk to.&lt;/p&gt;

&lt;pre&gt;
nodered:
  image: nieleyde/rpi2-nodered
  command: flows.json
  volumes:
    - /home/pi/node-red:/root/.node-red
  ports: 
    - &#34;1880:1880&#34;
  links:
    - mosquitto

mosquitto:
  image: nieleyde/rpi-mosquitto
  ports:
    - &#34;1883:1883&#34;
&lt;/pre&gt;

&lt;p&gt;Some subtleties to note:&lt;/p&gt;

&lt;p&gt;The nieleyde/rpi2-nodered runs on the Pi 2; there&#39;s a corresponding nieleyde/rpi-nodered for the Pi. Both are ARM images. I haven&#39;t yet tweaked this to run on x86, but if you do, you&#39;ll need to update the &#34;image&#34; stanzas everywhere.&lt;/p&gt;

&lt;p&gt;The &#34;command&#34; and &#34;volumes&#34; stanzas in the nodered configuration serve to make Docker mount a subdirectory on the host machine where the flows.json file is stored; this makes changes to the configuration persistent. If you want a read-only configuration, you&#39;ll need to change this; I haven&#39;t gotten that far yet. It might also make sense to have a data volume container, but again I&#39;m not there yet.&lt;/p&gt;

&lt;p&gt;The &#34;mosquitto&#34; configuration is extremely bare bones and runs the default config, which is wide open. I haven&#39;t gotten far enough to replace the config file with something better, but that&#39;s an obvious next step.&lt;/p&gt;

&lt;p&gt;From within Node-RED you refer to this internal MQTT server at hostname &#34;mosquitto&#34;, port &#34;1883&#34;. If the links stanza was changed to &#34;mqtt&#34; and the mosquitto section was changed to &#34;mqtt&#34; you&#39;d then refer to the MQTT server at hostname &#34;mqtt&#34;.&lt;/p&gt;

&lt;p&gt;For further reading:&lt;/p&gt;

&lt;p&gt;An issue open on Niel Eyde&#39;s rpi-nodered Github, &lt;a href=&#34;https://github.com/nieleyde/rpi-nodered/issues/5&#34;&gt;documentation for how to extend this image with your own nodes and flows&lt;/a&gt;, where I&#39;m working some of this out.&lt;/p&gt;

&lt;p&gt;On the Node-RED Github, &lt;a href=&#34;https://github.com/node-red/node-red/issues/603&#34;&gt;Support for Docker install for Node-RED&lt;/a&gt;, which is epic and helpful in many ways.&lt;/p&gt;

&lt;p&gt;The essential &lt;a href=&#34;http://blog.hypriot.com/&#34;&gt;Hypriot weblog&lt;/a&gt;, specifically the aforementioned &lt;a href=&#34;http://blog.hypriot.com/post/docker-compose-nodejs-haproxy/&#34;&gt;Docker Compose examples&lt;/a&gt; and the &lt;a href=&#34;https://github.com/hypriot/compose&#34;&gt;Hypriot Docker Compose&lt;/a&gt; Github repository.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Gogs, a self-hosted Git server</title>
      <link>http://vielmetti.github.io/post/2015/2015-06-27-gogs-a-self-hosted-git-server/</link>
      <pubDate>Sat, 27 Jun 2015 23:06:54 -0400</pubDate>
      
      <guid>http://vielmetti.github.io/post/2015/2015-06-27-gogs-a-self-hosted-git-server/</guid>
      <description>&lt;p&gt;Gogs is a self-hosted Git server, an alternative to using Github as a for-pay hosted service or Gitlab as another self-hosted system. It&#39;s written in the Go language, and is said to be sparing of system resources.&lt;/p&gt;

&lt;p&gt;&lt;a class=&#34;asset-img-link&#34;  href=&#34;http://vielmetti.typepad.com/.a/6a00d8341c4f1a53ef01b7c7a5b824970b-pi&#34;&gt;&lt;img class=&#34;asset  asset-image at-xid-6a00d8341c4f1a53ef01b7c7a5b824970b img-responsive&#34; style=&#34;width: 600px; display: block; margin-left: auto; margin-right: auto;&#34; alt=&#34;Screen Shot 2015-06-27 at 11.01.35 PM&#34; title=&#34;Screen Shot 2015-06-27 at 11.01.35 PM&#34; src=&#34;http://vielmetti.typepad.com/.a/6a00d8341c4f1a53ef01b7c7a5b824970b-600wi&#34; /&gt;&lt;/a&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;I&#39;m building it using Docker on a Raspberry Pi 2, thanks to the folks at Hypriot; the writeup is &lt;a href=&#34;http://blog.hypriot.com/post/run-your-own-github-like-service-with-docker/&#34;&gt;Run your own GitHub-like service with the help of Docker&lt;/a&gt;, and the file on Dockerhub is at &lt;a href=&#34;https://registry.hub.docker.com/u/hypriot/rpi-gogs-raspbian/&#34;&gt;hypriot/rpi-gogs-raspbian&lt;/a&gt;. The install went essentially as described; note that if you are using Avahi to provide a .local name service, you can avoid using IP addresses in configuration files and instead use names like &#34;black-pearl.local&#34; as your hostname.&lt;/p&gt;

&lt;p&gt;Juan B. Rodriguez did a nice writeup of &lt;a href=&#34;http://jbrodriguez.io/gogs-an-alternative-to-gitlab/&#34;&gt;Gogs, an alternative to Gitlab&lt;/a&gt;, again with a Docker based installation description and a nice feature comparison.&lt;/p&gt;

&lt;p&gt;After some poking around with Gogs I noted three substantial limitations, none of which are complete show-stoppers but which collectively give me pause about doing a wholesale replacement of Github with Gogs; and a fourth that gives me hope for some project that might address these issues but which might not end up being called Gogs.&lt;/p&gt;

&lt;p&gt;First, there&#39;s no built-in wiki. I don&#39;t always use a wiki with a Github repository, and when I do I&#39;m not always thrilled by the minimalist features of Github&#39;s wiki, but it&#39;s mighty handy and I miss it right away. Gogs doesn&#39;t have a wiki, and though it&#39;s been an acknowledged issue for a long time it doesn&#39;t seem to have any forward movement.&lt;/p&gt;

&lt;p&gt;Second, there&#39;s no built-in file editor. I&#39;m very used to the workflow where you see a file that has some small problem, you fork the repository right in the editor, type in your fix, save, and submit your patch to the maintainers. It&#39;s a very straightforward way of doing small things efficiently without dropping down to the command line, and the lack of it makes Gogs hard to understand how it would work in a mostly-web world.&lt;/p&gt;

&lt;p&gt;Third, Gogs has a lot of obvious copying from Github, and I&#39;m uncertain about the whole ethos of wholesale replication of documentation. Sometimes there&#39;s not even an effort made to document what the system does and instead there&#39;s just a link to Github documentation. Self-hosted systems should have self-hosted documentation, and even if you&#39;re replicating someone else&#39;s system faithfully you still need to write up your own docs.&lt;/p&gt;

&lt;p&gt;Fourth and finally, Gogs has been forked. &#34;gitea&#34; is &#34;Git with a cup of tea&#34;, and it seems to have a bunch of energy to fix things that the Gogs project is currently lacking. See &lt;a href=&#34;https://github.com/go-gitea/gitea&#34;&gt;the gitea project on Github&lt;/a&gt; and its corresponding &lt;a href=&#34;https://gitter.im/go-gitea/gitea&#34;&gt;gitter chat for gitea&lt;/a&gt;. gitea has not produced a release yet, but when it does I&#39;ll be sure to look for a reasonable packaging of it to try it out.&lt;/p&gt;

&lt;p&gt;All of that said, I&#39;m happy to have found Gogs, and plan to poke through it some more and store some not-very-important files in it for a while until I get some confidence in it. I don&#39;t think it (or gitea) is an instant replacement for my hosted Github service, but for the narrow purpose of holding a private repository beyond what Github provides for its service plan it looks like a reasonable alternative now.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Running Node-RED on a Raspberry Pi with Docker and Hypriot</title>
      <link>http://vielmetti.github.io/post/2015/2015-05-23-running-node-red-on-a-raspberry-pi-with-docker-and-hypriot/</link>
      <pubDate>Sat, 23 May 2015 02:06:33 -0400</pubDate>
      
      <guid>http://vielmetti.github.io/post/2015/2015-05-23-running-node-red-on-a-raspberry-pi-with-docker-and-hypriot/</guid>
      <description>&lt;p&gt;My goal for the week was to empty out my inbox sufficiently that I would be able to make progress on some programming tasks that are hard to do when there&#39;s distractions. The inbox got all the way down to zero, and that meant that there was a chunk of evening time suitable for hacking. Happy to report that the result of this is Node-RED running on a Raspberry Pi under Docker on top of Hypriot. A word of explanation of how this all works in detail is too much, but here&#39;s where I got the parts.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://blog.hypriot.com/getting-started-with-docker-on-your-arm-device/&#34;&gt;Hypriot&#39;s gettting started guide&lt;/a&gt; brings you up to speed on getting Docker running on your ARM device (e.g. your Raspberry Pi). They have bootable images that you can download and burn to SD card, and from there you load up applications from Docker.&lt;/p&gt;

&lt;p&gt;Hypriot has a &lt;a href=&#34;https://gitter.im/hypriot/talk&#34;&gt;chat window&lt;/a&gt; on Gitter, so you can pop in and there will be occasionally people to assist. Best to do things European time.&lt;/p&gt;

&lt;p&gt;Docker&#39;s &lt;a href=&#34;https://hub.docker.com/&#34;&gt;DockerHub&lt;/a&gt; is a one stop shop for packaged applications. When you&#39;re running on the Pi, you&#39;ll want to seek out versions with &#39;rpi&#39; or &#39;arm&#39; in their names as they have likely been adapted for that system.&lt;/p&gt;

&lt;p&gt;I ended up pulling Niel Eyde&#39;s Raspberry Pi versions of Node-RED from DockerHub as &lt;a href=&#34;https://registry.hub.docker.com/u/nieleyde/rpi-nodered/&#34;&gt;nieleyde/rpi-nodered&lt;/a&gt;. It has all sorts of interesting modules that I had not previously built.&lt;/p&gt;

&lt;p&gt;Node-RED is at 0.10.6 at this writing. Its &lt;a href=&#34;http://nodered.org/docs/hardware/raspberrypi.html&#34;&gt;Raspberry Pi support&lt;/a&gt; includes hardware support using &lt;a href=&#34;http://wiringpi.com/&#34;&gt;WiringPi&lt;/a&gt; to access the GPIO pins. &lt;/p&gt;

&lt;p&gt;Node-RED currently supports Node.JS 0.10. Node.JS and IO.JS have &lt;a href=&#34;http://sdtimes.com/node-js-and-io-js-to-merge-under-node-js-foundation/&#34;&gt;merged forces&lt;/a&gt; after a fork, which means hopefully development will start to be sane again.&lt;/p&gt;

&lt;p&gt;That all said I am not sure I have everything I need yet but as a leap forward it&#39;s pretty good!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>