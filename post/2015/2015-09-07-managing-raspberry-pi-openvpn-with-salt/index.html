<!DOCTYPE html>
<html lang="en-us">
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" Managing a Raspberry Pi OpenVPN with Salt &middot;  Vacuum weblog from Edward Vielmetti" />
  	<meta property="og:site_name" content="Vacuum weblog from Edward Vielmetti" />
  	<meta property="og:url" content="http://vielmetti.github.io/post/2015/2015-09-07-managing-raspberry-pi-openvpn-with-salt/" />
    
    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2015-09-07T00:45:00-04:00" />

    
    

  <title>
     Managing a Raspberry Pi OpenVPN with Salt &middot;  Vacuum weblog from Edward Vielmetti
  </title>

    <meta name="description" content="Tracking the comings and goings of @vielmetti" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://vielmetti.github.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="http://vielmetti.github.io/images/apple-touch-icon.png" />
    
    <link rel="stylesheet" type="text/css" href="http://vielmetti.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="http://vielmetti.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Vacuum weblog from Edward Vielmetti" />
      
      
    
    <meta name="generator" content="Hugo 0.15" />

    <link rel="canonical" href="http://vielmetti.github.io/post/2015/2015-09-07-managing-raspberry-pi-openvpn-with-salt/" />

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-83143-8', 'auto');
      ga('send', 'pageview');

    </script>
    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://vielmetti.github.io/post/about-this-weblog/">About this weblog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://vielmetti.github.io/post/2011/2011-11-20-moon-maps-lroc/">New map of the dark side of the moon from the Lunar Reconnaissance Orbiter Camera (LROC)</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://vielmetti.github.io/post/2011/2011-06-09-power-outage-maps/">Power outage maps for all 50 states plus as many other countries as I can find</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://vielmetti.github.io/post/2015/2015-11-01-slack-vs-irc/">Slack vs IRC</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://vielmetti.github.io/post/2014/2014-04-04-tune-in-to-skywarn-nets-in-50-states-when-severe-weather-threatens/">Tune in to Skywarn nets in 50 states when severe weather threatens</a>
            </li>
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="http://vielmetti.github.io/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Managing a Raspberry Pi OpenVPN with Salt</h1>
        <section class="post-meta">
        
          <time class="post-date" datetime="2015-09-07T00:45:00-04:00">
            Sep 7, 2015
          </time>
        
         
        </section>
    </header>
  
    <section class="post-content">
      <p>When you successfully install something complex, and then you fail
to document one small thing about how you did it, the inclination is
to over-document once you get it working again; thus, this expository
account of managing a set of Raspberry Pi devices using the &ldquo;salt&rdquo;
system. It&rsquo;s not a complete start to finish writeup, just a pointer to
the bits that I had forgotten.</p>

<p>This is mostly experimental at this point, and the collection of devices
is relatively small. I am pretty convinced that the Pi 2 has plenty of
gas to do more things than most people will try to do, but the original
Pi is slow enough and limited enough to perhaps make this scheme impractical.</p>

<p>When it works, you have a set of Pi&rsquo;s in various locations, all networked
together into an OpenVPN configuration.</p>

<p>First to read is <a href="http://garthwaite.org/virtually-secure-with-openvpn-pillars-and-salt.html">Virtually secure with openvpn, pillars, and salt</a> which
goes over the structure and motivation and design for an OpenVPN
network that answers this problem:</p>

<blockquote>
<p>How do I use salt to create and install the openvpn and client specific config files for each minion &ndash;on demand?</p>
</blockquote>

<p>If you follow Dan Garthwaite&rsquo;s design you get a reasonable
approach - when you bring up a new client you get a new key
generated, and on the server you run <code>salt-key -a</code> to accept the
new one.</p>

<p>This leaves only the problem of bootstrapping on the Pi&rsquo;s themselves.
The version of &lsquo;salt-minion&rsquo; that&rsquo;s available from the default
Debian system is very ancient, so that&rsquo;s useless. What you want
can be found at
<a href="http://servernetworktech.com/2014/05/setup-debian-saltstack-minion-single-command/">Setup a Debian Saltstack minion with a single command</a>
on the Server Network Tech blog; it brings in a new Debian
source list from Salt so that the bootstrap is easier.</p>

<p>(I realize this isn&rsquo;t a start to finish tutorial, just a few points
of clarification for bringing up new nodes once you have the whole
Salt environment running; sorry about that.)</p>

<p>The one thing I have left to do to make the setup more airtight is
to automate the process of locking down the sshd_config so that &ldquo;root&rdquo;
and &ldquo;pi&rdquo; can&rsquo;t login from far away, so that I can keep their default
passwords but restrict access to console access only.</p>

<p>Not mentioned here is that these Pi configuraiton are all on top of
the Hypriot setup so that they can (and do) run Docker. Though Docker
on the original Pi with salt-minion running doesn&rsquo;t leave a ton of
space spare for actual work to be done.</p>

    </section>


  <footer class="post-footer">


    

    





<section class="author">
  <h4><a href="http://vielmetti.github.io/">Edward Vielmetti</a></h4>
  
  <p>Read <a href="http://vielmetti.github.io/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Ann Arbor, Michigan</span>
    
  </div>
</section>



    
    <section class="share">
      <h4>Share this post</h4>
      <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Managing%20a%20Raspberry%20Pi%20OpenVPN%20with%20Salt&amp;url=http%3a%2f%2fvielmetti.github.io%2fpost%2f2015%2f2015-09-07-managing-raspberry-pi-openvpn-with-salt%2f"
          onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <span class="hidden">Twitter</span>
      </a>
      <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fvielmetti.github.io%2fpost%2f2015%2f2015-09-07-managing-raspberry-pi-openvpn-with-salt%2f"
          onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <span class="hidden">Facebook</span>
      </a>
      <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2fvielmetti.github.io%2fpost%2f2015%2f2015-09-07-managing-raspberry-pi-openvpn-with-salt%2f"
         onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
          <span class="hidden">Google+</span>
      </a>
    </section>
    

    
    
    

  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Vacuum weblog from Edward Vielmetti</a> </section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://vielmetti.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="http://vielmetti.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://vielmetti.github.io/js/index.js"></script>

</body>
</html>

