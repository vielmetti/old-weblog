<!DOCTYPE html> 
<html>
<head> 
		<title>Managing a Raspberry Pi OpenVPN with Salt - Vacuum - Edward Vielmetti</title> 
	</head>
<body>


<h2>Vacuum weblog E. Vielmetti</h2>


<h3>
<a href="http://vielmetti.github.io/books/">books</a>
<a href="http://vielmetti.github.io/code/">code</a>
<a href="http://vielmetti.github.io/recipes/">recipes</a>
<a href="http://vielmetti.github.io/people/">people</a>
<a href="http://vielmetti.github.io/cities/">cities</a>
<a href="http://vielmetti.github.io/maps/">maps</a>
<a href="http://vielmetti.github.io/annarbor/">Ann Arbor</a>
<a href="http://vielmetti.github.io/categories/">categories</a>
<a href="http://vielmetti.github.io/keyphrases/">keyphrases</a>
</h3>




<h5>nature abhors a vacuum</h5>


<table>
<tr>
	

<td width="5%"></td>


<td width="30%" valign="top">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Vacuum weblog from Edward Vielmetti</h1>
      <p class="lead">
       Tracking the comings and goings of @vielmetti 
      </p>
    </div>

    <h3><a href="http://vielmetti.github.io/">Home</a> </h3>
    <ul class="sidebar-nav">
      
        <li><a href="http://vielmetti.github.io/post/2015/2015-07-14-publishing-from-hugo-to-github-pages"> Publishing from Hugo to Github Pages </a></li>
      
    </ul>

    <h3 class="panel-title">Recent Posts</h3> 
    <ul class="sidebar-recent">
	 
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-17-qso-on-redditnet" class="list-group-item">QSO on redditnet via Geekshed IRC</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-14-letterpress-qsl-cards" class="list-group-item">Letterpress QSL cards</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-14-aprs-network-status" class="list-group-item">Ann Arbor area APRS network status, January 2016</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-13-building-board-of-appeals-lacks-quorum-january-2016" class="list-group-item">January 2016 Ann Arbor Building Board of Appeals lacks a quorum</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-13-dave-new-n8sbe-sdr-at-arrow" class="list-group-item">Dave New N8SBE to speak at ARROW on Software Defined Radio</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-08-central-michigan-responds-to-morning-sun-wcmu-editorial" class="list-group-item">Central Michigan University spokesman responds to Morning Sun editorial regarding WCMU-TV spectrum auction</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-08-a2council-liquor-license-report" class="list-group-item">Ann Arbor City Council Liquor License Review Committee report, 8 January 2016</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-08-oxford-flood-network" class="list-group-item">Oxford Flood Network</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-07-dexter-fire-inverness-condo" class="list-group-item">Fire on Inverness in Dexter, Michigan</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-07-county-health-food-inspection-delays" class="list-group-item">Washtenaw County Health Department delays food inspection reporting from November 2015</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-06-cuts-coming-to-mlive" class="list-group-item">Cuts coming to MLive, 2016 edition; 29 content positions eliminated</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-06-wkar-television-spectrum-sale" class="list-group-item">WKAR-TV television spectrum may be up for sale, and the station is at risk</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-02-learning-morse-code" class="list-group-item">Learning Morse Code</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-01-qsl-card-template" class="list-group-item">QSL card template for Lob.com</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-22-kale-into-ice-cream" class="list-group-item">How I turned 99 cents worth of kale into half a gallon of delicious ice cream</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-21-mailchimp-form" class="list-group-item">Subscribe to a2b3 list through Mailchimp</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-18-a-visit-to-um-cvga" class="list-group-item">A visit to the Computer and Video Game Archive, @umcvga</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-17-santa-at-swedes-diner" class="list-group-item">Santa visiting Swede&#39;s Diner, Ann Arbor, December 1950</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-17-iot-platforms" class="list-group-item">Platforms for the Internet of Things, 2015 edition</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-16-douglas-vielmetti-plant-engineer" class="list-group-item">Douglas E. Vielmetti, plant engineer</a></li>
        
    </ul>

    <div class="sidebar-calendar">
	
    </div>

    <div class="sidebar-todo">
	
    </div>

    <div class="sidebar-blogroll">
	
    </div>

    <p>&copy; 2016. All rights reserved. </p>
  </div>
</div>

</td>


<td width="5%" valign="top"></td>


<td width="55%" valign="top" halign="right">
		<h3>7 September 2015</h3>
		<h1>Managing a Raspberry Pi OpenVPN with Salt</h1> 
		<p>When you successfully install something complex, and then you fail
to document one small thing about how you did it, the inclination is
to over-document once you get it working again; thus, this expository
account of managing a set of Raspberry Pi devices using the &ldquo;salt&rdquo;
system. It&rsquo;s not a complete start to finish writeup, just a pointer to
the bits that I had forgotten.</p>

<p>This is mostly experimental at this point, and the collection of devices
is relatively small. I am pretty convinced that the Pi 2 has plenty of
gas to do more things than most people will try to do, but the original
Pi is slow enough and limited enough to perhaps make this scheme impractical.</p>

<p>When it works, you have a set of Pi&rsquo;s in various locations, all networked
together into an OpenVPN configuration.</p>

<p>First to read is <a href="http://garthwaite.org/virtually-secure-with-openvpn-pillars-and-salt.html">Virtually secure with openvpn, pillars, and salt</a> which
goes over the structure and motivation and design for an OpenVPN
network that answers this problem:</p>

<blockquote>
<p>How do I use salt to create and install the openvpn and client specific config files for each minion &ndash;on demand?</p>
</blockquote>

<p>If you follow Dan Garthwaite&rsquo;s design you get a reasonable
approach - when you bring up a new client you get a new key
generated, and on the server you run <code>salt-key -a</code> to accept the
new one.</p>

<p>This leaves only the problem of bootstrapping on the Pi&rsquo;s themselves.
The version of &lsquo;salt-minion&rsquo; that&rsquo;s available from the default
Debian system is very ancient, so that&rsquo;s useless. What you want
can be found at
<a href="http://servernetworktech.com/2014/05/setup-debian-saltstack-minion-single-command/">Setup a Debian Saltstack minion with a single command</a>
on the Server Network Tech blog; it brings in a new Debian
source list from Salt so that the bootstrap is easier.</p>

<p>(I realize this isn&rsquo;t a start to finish tutorial, just a few points
of clarification for bringing up new nodes once you have the whole
Salt environment running; sorry about that.)</p>

<p>The one thing I have left to do to make the setup more airtight is
to automate the process of locking down the sshd_config so that &ldquo;root&rdquo;
and &ldquo;pi&rdquo; can&rsquo;t login from far away, so that I can keep their default
passwords but restrict access to console access only.</p>

<p>Not mentioned here is that these Pi configuraiton are all on top of
the Hypriot setup so that they can (and do) run Docker. Though Docker
on the original Pi with salt-minion running doesn&rsquo;t leave a ton of
space spare for actual work to be done.</p>
 
</td>


<td width="5%" valign="top"></td>

</tr>
</table>


<h3>Notes afterwards</h3>
	<p>
	Recreating more or less my original layout, but with 
	dynamically loaded content. I guess that could work!
	</p>
	<p>
<a title="Real Time Analytics" href="http://clicky.com/100880293"><img alt="Real Time Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100880293); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100880293ns.gif" /></p></noscript>
</p>

</body>
</html> 
