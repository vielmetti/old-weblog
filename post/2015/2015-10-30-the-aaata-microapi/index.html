<!DOCTYPE html> 
<html>
<head> 
		<title>The AAATA MicroAPI - Vacuum - Edward Vielmetti</title> 
	</head>
<body>


<h2>Vacuum weblog E. Vielmetti</h2>


<h3>
<a href="http://vielmetti.github.io/books/">books</a>
<a href="http://vielmetti.github.io/code/">code</a>
<a href="http://vielmetti.github.io/recipes/">recipes</a>
<a href="http://vielmetti.github.io/people/">people</a>
<a href="http://vielmetti.github.io/cities/">cities</a>
<a href="http://vielmetti.github.io/maps/">maps</a>
<a href="http://vielmetti.github.io/annarbor/">Ann Arbor</a>
<a href="http://vielmetti.github.io/categories/">categories</a>
<a href="http://vielmetti.github.io/keyphrases/">keyphrases</a>
</h3>




<h5>nature abhors a vacuum</h5>


<table>
<tr>
	

<td width="5%"></td>


<td width="30%" valign="top">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Vacuum weblog from Edward Vielmetti</h1>
      <p class="lead">
       Tracking the comings and goings of @vielmetti 
      </p>
    </div>

    <h3><a href="http://vielmetti.github.io/">Home</a> </h3>
    <ul class="sidebar-nav">
      
        <li><a href="http://vielmetti.github.io/post/2015/2015-07-14-publishing-from-hugo-to-github-pages/"> Publishing from Hugo to Github Pages </a></li>
      
    </ul>

    <h3 class="panel-title">Recent Posts</h3> 
    <ul class="sidebar-recent">
	 
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-25-a-commonplace-reader/" class="list-group-item">A commonplace reader</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-24-zingermans-coffee/" class="list-group-item">At Zingermans Coffee for an afternoon of writing</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-23-day-trips-from-ann-arbor/" class="list-group-item">Day trips from Ann Arbor</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-18-bots-are-hot/" class="list-group-item">Bots are hot - again</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-01-three-column-writing-style/" class="list-group-item">Three column writing style</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-01-roosroast-may-day/" class="list-group-item">May Day at Roos Roast with Burroughs and Polya</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-25-hidden-water-flush-maps/" class="list-group-item">Ann Arbor hydrant flushing maps</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-25-mdeq-flint-water-graphic/" class="list-group-item">Michigan DEQ with misleading graphic on progress in Flint Water Crisis</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-24-incomplete-image/" class="list-group-item">The incomplete image</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-24-mechanical-slaves/" class="list-group-item">Mechanical slaves and the Californian ideology</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-24-game-of-fail-hbonow-down/" class="list-group-item">Game of Fail - HBO Now unable to host Game of Thrones premiere</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-24-facebook-break/" class="list-group-item">Taking a break from Facebook</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-23-roos-roast-downtown/" class="list-group-item">Roos Roast to add downtown Ann Arbor location</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-22-washtenaw-restaraunt-inspections/" class="list-group-item">Washtenaw restaurant inspections</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-22-prince/" class="list-group-item">Prince</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-22-milnor-time/" class="list-group-item">Milnor Time at Mr. Stadium</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-17-ecuador-terremoto/" class="list-group-item">Earthquake in Ecuador, April 16, 2016</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-06-reluctance/" class="list-group-item">Reluctance</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-06-yo/" class="list-group-item">Yo</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-03-30-upgrade-to-el-capitan/" class="list-group-item">Upgrade to El Capitan</a></li>
        
    </ul>

    <div class="sidebar-calendar">
	
    </div>

    <div class="sidebar-todo">
	
    </div>

    <div class="sidebar-blogroll">
	
    </div>

    <p>&copy; 2016. All rights reserved. </p>
  </div>
</div>

</td>


<td width="5%" valign="top"></td>


<td width="55%" valign="top" halign="right">
		<h3>30 October 2015</h3>
		<h1>The AAATA MicroAPI</h1> 
		<p>I had a good conversation with Prabal Dutta today about the sort of infrastructure
you need to build a very simple bus tracker application for the current iteration
of the AAATA&rsquo;s online system.</p>

<p>The desired goal is actually fairly simple: for a single place, identify the approximate
location of a bus on a single bus line that serves that place, and alert the rider in time
so that they can walk (or run) to catch the bus. Allow some time for getting there early.</p>

<p>The JSON endpoint that shows all the buses on Route 5 you can fetch as follows:</p>

<pre><code>curl -s http://microapi.theride.org/Location/5
</code></pre>

<p>and the data itself has records that look like this:</p>

<pre><code>  {
    &quot;Id&quot;: &quot;48674187&quot;,
    &quot;routeAbbr&quot;: &quot;5&quot;,
    &quot;adherence&quot;: -5,
    &quot;timestamp&quot;: &quot;00:01:11.1189770&quot;,
    &quot;lat&quot;: 422301779,
    &quot;longitude&quot;: -837077535,
    &quot;busNum&quot;: 401,
    &quot;routeDirection&quot;: &quot;to Ann Arbor&quot;,
    &quot;timePointName&quot;: &quot;Ellsworth &amp; Braeburn&quot;,
    &quot;timePointAltName&quot;: &quot;N- Ellsworth Rd. west of Braeburn&quot;,
    &quot;crossingTime&quot;: &quot;4:46 PM&quot;,
    &quot;timePointStopID&quot;: &quot;1327&quot;
  },
</code></pre>

<p>which reads as follows: &ldquo;At 4:46 PM, bus 401 was 5 minutes late and located at
the Ellsworth &amp; Braeburn timepoint. That was 1 minute 11.1 seconds ago.&rdquo;</p>

<p>It&rsquo;s then a short exercise left to the reader to suss out what this means for them.
The simplest thing to do is to filter through the bus listings, pick out the ones
where &ldquo;routeDirection&rdquo; is heading the right way, and where the &ldquo;timePointName&rdquo; is
close enough that you can run for the bus but not so close that the bus has already
zoomed past.</p>

<p>My favorite general purpose tool for dealing with JSON data is <code>jq</code>, from
<a href="https://stedolan.github.io/jq/">https://stedolan.github.io/jq/</a> . It has a syntax for filtering through and querying
JSON objects with about as much expressive power as <code>sed</code>. The slightly more
useful command runs like</p>

<pre><code>curl -s http://microapi.theride.org/Location/5 | jq -c '.[]|[.routeDirection, .timePointName]' 
</code></pre>

<p>which picks out <code>routeDirection</code> and <code>timePointName</code> and lands them on a single line <code>-c</code>
suitable for any of your favorite Unix tools.</p>
 
</td>


<td width="5%" valign="top"></td>

</tr>
</table>


<h3>Notes afterwards</h3>
	<p>
	Recreating more or less my original layout, but with 
	dynamically loaded content. I guess that could work!
	</p>
	<p>
<a title="Real Time Analytics" href="http://clicky.com/100880293"><img alt="Real Time Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100880293); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100880293ns.gif" /></p></noscript>
</p>

</body>
</html> 
