<!DOCTYPE html> 
<html>
<body>
<title>Vacuum</title>


<h2>Vacuum weblog E. Vielmetti</h2>


<h3>
<a href="http://vielmetti.github.io/books/">books</a>
<a href="http://vielmetti.github.io/code/">code</a>
<a href="http://vielmetti.github.io/recipes/">recipes</a>
<a href="http://vielmetti.github.io/people/">people</a>
<a href="http://vielmetti.github.io/cities/">cities</a>
<a href="http://vielmetti.github.io/maps/">maps</a>
<a href="http://vielmetti.github.io/annarbor/">Ann Arbor</a>
<a href="http://vielmetti.github.io/categories/">categories</a>
<a href="http://vielmetti.github.io/keyphrases/">keyphrases</a>
</h3>




<h5>nature abhors a vacuum</h5>


<table>
<tr>
	

<td width="5%"></td>


<td width="30%" valign="top">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Vacuum weblog from Edward Vielmetti</h1>
      <p class="lead">
       Tracking the comings and goings of @vielmetti 
      </p>
    </div>

    <h3><a href="http://vielmetti.github.io/">Home</a> </h3>
    <ul class="sidebar-nav">
      
        <li><a href="http://vielmetti.github.io/post/2015/2015-07-14-publishing-from-hugo-to-github-pages"> Publishing from Hugo to Github Pages </a></li>
      
    </ul>

    <h3 class="panel-title">Recent Posts</h3> 
    <ul class="sidebar-recent">
	 
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-24-radio-havana-cuba" class="list-group-item">Listening to Radio Havana Cuba via a shortwave software defined radio</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-24-summer-dinner" class="list-group-item">Summer dinner</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-23-gqrx-scanner" class="list-group-item">GQRX based radio scanner with gqrx-scan</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-22-github-waffle-kanban-board" class="list-group-item">Using Github Issues and Waffle.io as a personal kanban board</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-22-august-farmers-market-report" class="list-group-item">August 2015 Farmers Market report</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-22-ashley-madison-ann-arbor" class="list-group-item">Ashley and Madison, Ann Arbor</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-19-liquid-contact-indicator-tripped" class="list-group-item">Liquid contact indicator tripped</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-15-a2council-preview" class="list-group-item">Ann Arbor City Council Preview for 17 August 2015</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-14-tianjin-explosion" class="list-group-item">Tianjin explosion</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-13-zenos-inbox" class="list-group-item">Zeno&#39;s inbox</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-13-a2b3-lunch-nonsummary-broken-egg" class="list-group-item">a2b3 lunch non-summary for the Broken Egg</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-09-long-form" class="list-group-item">long form</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-07-all-watched-over-by-machines" class="list-group-item">All watched over by machines</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-06-a2b3-mi-compadre-non-summary" class="list-group-item">a2b3 lunch non-summary for August 6, 2015 at Mi Compadre</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-05-wakatime" class="list-group-item">wakatime, an automatic time tracker for programmers</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-04-robo-assistant-xdotai" class="list-group-item">Your new robo-assistant, Amy Ingram</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-04-i-voted" class="list-group-item">I voted, summer 2015 edition</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-03-expertise" class="list-group-item">expertise encapsulated into out of date memory banks</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-03-michigan-emergency-incidents" class="list-group-item">Michigan Emergency Incidents and overnight storm report</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-02-small-multiples" class="list-group-item">Small multiples</a></li>
        
    </ul>

    <div class="sidebar-calendar">
	
    </div>

    <div class="sidebar-todo">
	
    </div>

    <div class="sidebar-blogroll">
	
    </div>

    <p>&copy; 2015. All rights reserved. </p>
  </div>
</div>

</td>


<td width="5%" valign="top"></td>


<td width="55%" valign="top" halign="right">
		<title>Bringing up Node-RED and mosquitto under &#34;docker compose&#34; on a Raspberry Pi</title> 
	</head> 
	<body> 
		<h3>13 July 2015</h3>
		<h1>Bringing up Node-RED and mosquitto under &#34;docker compose&#34; on a Raspberry Pi</h1> 
		<p>Progress, actually quite a lot of it:</p>

<p>The problem, neatly stated. Docker is good for bringing up single services ("microservices"), but sometimes your application needs more than one thing running for the whole thing to work. Enter "docker compose", formerly "fig", which automates the process of running various Docker commands in the right order with the right arguments all driven from a configuration file. As described by their documentation:</p>

<blockquote>
  <p>Compose is a tool for defining and running complex applications with Docker. With Compose, you define a multi-container application in a single file, then spin your application up in a single command which does everything that needs to be done to get it running.</p>
</blockquote>

<p>The particular task I have in front of me is launching Node-RED and mosquitto (an MQTT broker) together on a Raspberry Pi 2 which is running Hypriot and Docker. Most of the background for <em>why</em> that's a relevant task is at this post on Hypriot, <a href="http://blog.hypriot.com/post/docker-compose-nodejs-haproxy/">How to use Docker Compose to run complex multi container apps on your Raspberry Pi</a>, which I dutifully and successfully managed to run all of the examples from. </p>

<p>Emboldened by this I tried to get Wordpress running with MySQL but got stuck because of a variety of things (not the least of which was some over-enthusiastic documentation that downplayed the complexity of that task, and the lack of a Pi-specific Wordpress Docker images). But having had the taste of what might be I carried on until I managed to get something to work for what I really wanted: Node-RED running alongside mosquitto so that I could have a local MQTT broker to talk to.</p>

<pre>
nodered:
  image: nieleyde/rpi2-nodered
  command: flows.json
  volumes:
    - /home/pi/node-red:/root/.node-red
  ports: 
    - "1880:1880"
  links:
    - mosquitto

mosquitto:
  image: nieleyde/rpi-mosquitto
  ports:
    - "1883:1883"
</pre>

<p>Some subtleties to note:</p>

<p>The nieleyde/rpi2-nodered runs on the Pi 2; there's a corresponding nieleyde/rpi-nodered for the Pi. Both are ARM images. I haven't yet tweaked this to run on x86, but if you do, you'll need to update the "image" stanzas everywhere.</p>

<p>The "command" and "volumes" stanzas in the nodered configuration serve to make Docker mount a subdirectory on the host machine where the flows.json file is stored; this makes changes to the configuration persistent. If you want a read-only configuration, you'll need to change this; I haven't gotten that far yet. It might also make sense to have a data volume container, but again I'm not there yet.</p>

<p>The "mosquitto" configuration is extremely bare bones and runs the default config, which is wide open. I haven't gotten far enough to replace the config file with something better, but that's an obvious next step.</p>

<p>From within Node-RED you refer to this internal MQTT server at hostname "mosquitto", port "1883". If the links stanza was changed to "mqtt" and the mosquitto section was changed to "mqtt" you'd then refer to the MQTT server at hostname "mqtt".</p>

<p>For further reading:</p>

<p>An issue open on Niel Eyde's rpi-nodered Github, <a href="https://github.com/nieleyde/rpi-nodered/issues/5">documentation for how to extend this image with your own nodes and flows</a>, where I'm working some of this out.</p>

<p>On the Node-RED Github, <a href="https://github.com/node-red/node-red/issues/603">Support for Docker install for Node-RED</a>, which is epic and helpful in many ways.</p>

<p>The essential <a href="http://blog.hypriot.com/">Hypriot weblog</a>, specifically the aforementioned <a href="http://blog.hypriot.com/post/docker-compose-nodejs-haproxy/">Docker Compose examples</a> and the <a href="https://github.com/hypriot/compose">Hypriot Docker Compose</a> Github repository.</p>
 
	</body> 
</td>


<td width="5%" valign="top"></td>

</tr>
</table>


<h3>Notes afterwards</h3>
	<p>
	Recreating more or less my original layout, but with 
	dynamically loaded content. I guess that could work!
	</p>

</body>
</html> 
