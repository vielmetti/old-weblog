<!DOCTYPE html> 
<html>
<body>
<title>Vacuum</title>


<h2>Vacuum weblog E. Vielmetti</h2>


<h3>
<a href="http://vielmetti.github.io/books/">books</a>
<a href="http://vielmetti.github.io/code/">code</a>
<a href="http://vielmetti.github.io/recipes/">recipes</a>
<a href="http://vielmetti.github.io/people/">people</a>
<a href="http://vielmetti.github.io/cities/">cities</a>
<a href="http://vielmetti.github.io/maps/">maps</a>
<a href="http://vielmetti.github.io/annarbor/">Ann Arbor</a>
<a href="http://vielmetti.github.io/categories/">categories</a>
<a href="http://vielmetti.github.io/keyphrases/">keyphrases</a>
</h3>




<h5>nature abhors a vacuum</h5>


<table>
<tr>
	

<td width="5%"></td>


<td width="30%" valign="top">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>tracker</h1>
      <p class="lead">
       Tracking the comings and goings of @vielmetti 
      </p>
    </div>

    <h3><a href="http://vielmetti.github.io/">Home</a> </h3>
    <ul class="sidebar-nav">
      
        <li><a href="http://vielmetti.github.io/post/2015/2015-07-14-publishing-from-hugo-to-github-pages"> Publishing from Hugo to Github Pages </a></li>
      
    </ul>

    <h3 class="panel-title">Recent Posts</h3> 
    <ul class="sidebar-recent">
	 
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-22-august-farmers-market-report" class="list-group-item">August 2015 Farmers Market report</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-22-ashley-madison-ann-arbor" class="list-group-item">Ashley and Madison, Ann Arbor</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-19-liquid-contact-indicator-tripped" class="list-group-item">Liquid contact indicator tripped</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-15-a2council-preview" class="list-group-item">Ann Arbor City Council Preview for 17 August 2015</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-14-tianjin-explosion" class="list-group-item">Tianjin explosion</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-13-zenos-inbox" class="list-group-item">Zeno&#39;s inbox</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-13-a2b3-lunch-nonsummary-broken-egg" class="list-group-item">a2b3 lunch non-summary for the Broken Egg</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-09-long-form" class="list-group-item">long form</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-07-all-watched-over-by-machines" class="list-group-item">All watched over by machines</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-06-a2b3-mi-compadre-non-summary" class="list-group-item">a2b3 lunch non-summary for August 6, 2015 at Mi Compadre</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-05-wakatime" class="list-group-item">wakatime, an automatic time tracker for programmers</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-04-robo-assistant-xdotai" class="list-group-item">Your new robo-assistant, Amy Ingram</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-04-i-voted" class="list-group-item">I voted, summer 2015 edition</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-03-expertise" class="list-group-item">expertise encapsulated into out of date memory banks</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-03-michigan-emergency-incidents" class="list-group-item">Michigan Emergency Incidents and overnight storm report</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-02-small-multiples" class="list-group-item">Small multiples</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-02-blogroll" class="list-group-item">Blogrolls</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-08-01-knolling" class="list-group-item">Knolling</a></li>
         
	<li><a href="http://vielmetti.github.io/sidebar/todo" class="list-group-item">todo</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-31-mitmproxy" class="list-group-item">mitmproxy</a></li>
        
    </ul>

    <div class="sidebar-calendar">
	
    </div>

    <div class="sidebar-todo">
	
    </div>

    <div class="sidebar-blogroll">
	
    </div>

    <p>&copy; 2015. All rights reserved. </p>
  </div>
</div>

</td>


<td width="5%" valign="top"></td>


<td width="55%" valign="top" halign="right">
		<title>Using GNU Parallel to speed up network operations</title> 
	</head> 
	<body> 
		<h3>24 June 2015</h3>
		<h1>Using GNU Parallel to speed up network operations</h1> 
		<p>My current laptop (a MacBook Air) has a plenty fast processor and super fast disk. This means that the usual bottleneck for system operations is the network, not the computer itself. I go from wifi spot to other wifi spot enough that I know that performance varies a lot, and especially there are a lot of places where the network is really not fast enough.</p>

<p>Enter GNU Parallel. This little tool lets you spawn a whole series of processes, with the next one starting when the previous one completes. If you are working on something where it doesn't matter which order things happen in as long as they all get done you are in good shape to get tremendous performance improvements simply by overlapping operations.</p>

<p>An example:</p>

<p>DTE Energy does not have one single page on their web site that shows you the total number of outages across their system - or if they do have it, it's so well hidden that I haven't found it. What they do have is a way to fetch the outage count for a single ZIP code. So, armed with a set of zip codes, you can determine a total. You don't care which ZIP is fetched first but you do want them all to show up before you add them up.</p>

<p>The one-line command I have for this is</p>

<p><code>
parallel -P 32 -a ~/data/dte-zips ~/bin/dte-by-zip | jq -s add
</code></p>

<p>The script dte-by-zip runs as follows, fetching a page from a DTE server and parsing it:</p>

<blockquote>
  <p>$ dte-by-zip 48104</p>
  
  <p>38</p>
</blockquote>

<p>thus the parallel invocation reads roughly as follows: "for 32 parallel threads, using the dte-zips data file one line a time as command line arguments, run dte-by-zip; add up all the results".</p>

<p>Note that if you are using "curl" to fetch pages, you want to be aware of the <code>--max-time</code> option.</p>

<blockquote>
  <p>-m, --max-time <seconds>
               Maximum time in seconds that you allow the  whole  operation  to
               take.   This is useful for preventing your batch jobs from hang-
               ing for hours due to slow networks or links going  down. </p>
</blockquote>

<p>Now you don't want to go too crazy with parallel operations on network resources, it's possible to overrun a remote server and it might be faster to pull 8 or 16 parallel threads instead of 32 or 64 depending on the nature of the remote machine.</p>

<p>Article describing tool (for citations):</p>

<p>O. Tange (2011): GNU Parallel - The Command-Line Power Tool, ;login: The USENIX Magazine, February 2011:42-47.</p>

<p>Authors' website for obtaining code:</p>

<p>http://www.gnu.org/software/parallel/</p>
 
	</body> 
</td>


<td width="5%" valign="top"></td>

</tr>
</table>


<h3>Notes afterwards</h3>
	<p>
	Recreating more or less my original layout, but with 
	dynamically loaded content. I guess that could work!
	</p>

</body>
</html> 
