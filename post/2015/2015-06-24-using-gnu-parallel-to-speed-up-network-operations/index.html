<!DOCTYPE html> 
<html>
<body>
<title>Vacuum</title>


<h2>Vacuum weblog E. Vielmetti</h2>


<h3>
<a href="http://localhost:1313/books/">books</a>
music
jobs
<a href="http://localhost:1313/recipes/">recipes</a>
<a href="http://localhost:1313/people/">people</a>
<a href="http://localhost:1313/cities/">cities</a>
<a href="http://localhost:1313/maps/">maps</a>
networks
</h3>




<h5>nature abhors a vacuum</h5>


<table>
<tr>
	

<td width="5%"></td>


<td width="30%" valign="top">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>tracker</h1>
      <p class="lead">
       Tracking the comings and goings of @vielmetti 
      </p>
    </div>

    <h3><a href="http://localhost:1313/">Home</a> </h3>
    <ul class="sidebar-nav">
      
        <li><a href="http://localhost:1313/post/2015/2015-07-14-publishing-from-hugo-to-github-pages"> Publishing from Hugo to Github Pages </a></li>
      
    </ul>

    <h3 class="panel-title">Recent Posts</h3> 
    <ul class="sidebar-recent">
	 
	<li><a href="http://localhost:1313/post/2015/2015-07-15-diligently-editing-and-converting-for-production" class="list-group-item">diligently editing and converting for production</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-14-a-great-many-things" class="list-group-item">a great many things</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-14-the-hugo-cookbook" class="list-group-item">the hugo cookbook</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-14-sweet-potato-cauliflower-soup" class="list-group-item">sweet potato cauliflower soup recipe</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-14-publishing-from-hugo-to-github-pages" class="list-group-item">Publishing from Hugo to Github Pages</a></li>
         
	<li><a href="http://localhost:1313/post/Mac-and-Goat" class="list-group-item">Mac and Goat</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-14-customizing-a-theme" class="list-group-item">customizing a theme</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-14-converting-typepad-to-hugo" class="list-group-item">converting typepad to hugo</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-14-lunch-with-jonathan" class="list-group-item">lunch with jonathan</a></li>
         
	<li><a href="http://localhost:1313/post/wow-that-is-fast" class="list-group-item">wow that is fast</a></li>
         
	<li><a href="http://localhost:1313/sidebar/calendar" class="list-group-item">Calendar of events</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-13-bringing-up-node-red-and-mosquitto-under-docker-compose-on-a-raspberry-pi" class="list-group-item">Bringing up Node-RED and mosquitto under &#34;docker compose&#34; on a Raspberry Pi</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-11-gooseberries-at-ann-arbor-farmers-market" class="list-group-item">gooseberries at Ann Arbor Farmers Market</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-06-ann-arbor-city-council-for-july-6-2015-online-video-stream-goes-dark" class="list-group-item">Ann Arbor City Council for July 6, 2015: online video stream goes dark</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-06-the-verge-turns-off-comments" class="list-group-item">The Verge turns off comments</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-07-03-reddit-is-going-up-in-flames" class="list-group-item">&#34;Reddit is going up in flames&#34;</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-06-29-never-read-the-comments" class="list-group-item">Never read the comments</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-06-29-bbc-greeces-bank-holiday-from-hell-impact-on-bitcoin-transactions" class="list-group-item">BBC: &#34;Greece&#39;s bank holiday from hell&#34;; impact on Bitcoin transactions?</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-06-28-a-random-walk-through-the-rolodex" class="list-group-item">A random walk through the rolodex</a></li>
         
	<li><a href="http://localhost:1313/post/2015/2015-06-28-using-a-squid-cache-to-make-automated-data-collection-a-bit-less-rude" class="list-group-item">Using a squid cache to make automated data collection a bit less rude</a></li>
        
    </ul>

    <div class="sidebar-calendar">
	
    </div>


    <p>&copy; 2015. All rights reserved. </p>
  </div>
</div>

</td>


<td width="5%" valign="top"></td>


<td width="55%" valign="top" halign="right">
		<title>Using GNU Parallel to speed up network operations</title> 
	</head> 
	<body> 
		<h3>24 June 2015</h3>
		<h1>Using GNU Parallel to speed up network operations</h1> 
		<p>My current laptop (a MacBook Air) has a plenty fast processor and super fast disk. This means that the usual bottleneck for system operations is the network, not the computer itself. I go from wifi spot to other wifi spot enough that I know that performance varies a lot, and especially there are a lot of places where the network is really not fast enough.</p>

<p>Enter GNU Parallel. This little tool lets you spawn a whole series of processes, with the next one starting when the previous one completes. If you are working on something where it doesn't matter which order things happen in as long as they all get done you are in good shape to get tremendous performance improvements simply by overlapping operations.</p>

<p>An example:</p>

<p>DTE Energy does not have one single page on their web site that shows you the total number of outages across their system - or if they do have it, it's so well hidden that I haven't found it. What they do have is a way to fetch the outage count for a single ZIP code. So, armed with a set of zip codes, you can determine a total. You don't care which ZIP is fetched first but you do want them all to show up before you add them up.</p>

<p>The one-line command I have for this is</p>

<p><code>
parallel -P 32 -a ~/data/dte-zips ~/bin/dte-by-zip | jq -s add
</code></p>

<p>The script dte-by-zip runs as follows, fetching a page from a DTE server and parsing it:</p>

<blockquote>
  <p>$ dte-by-zip 48104</p>
  
  <p>38</p>
</blockquote>

<p>thus the parallel invocation reads roughly as follows: "for 32 parallel threads, using the dte-zips data file one line a time as command line arguments, run dte-by-zip; add up all the results".</p>

<p>Note that if you are using "curl" to fetch pages, you want to be aware of the <code>--max-time</code> option.</p>

<blockquote>
  <p>-m, --max-time <seconds>
               Maximum time in seconds that you allow the  whole  operation  to
               take.   This is useful for preventing your batch jobs from hang-
               ing for hours due to slow networks or links going  down. </p>
</blockquote>

<p>Now you don't want to go too crazy with parallel operations on network resources, it's possible to overrun a remote server and it might be faster to pull 8 or 16 parallel threads instead of 32 or 64 depending on the nature of the remote machine.</p>

<p>Article describing tool (for citations):</p>

<p>O. Tange (2011): GNU Parallel - The Command-Line Power Tool, ;login: The USENIX Magazine, February 2011:42-47.</p>

<p>Authors' website for obtaining code:</p>

<p>http://www.gnu.org/software/parallel/</p>
 
	<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body> 
</td>


<td width="5%" valign="top"></td>

</tr>
</table>


<h3>Notes afterwards</h3>
	<p>
	Recreating more or less my original layout, but with 
	dynamically loaded content. I guess that could work!
	</p>

<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html> 
