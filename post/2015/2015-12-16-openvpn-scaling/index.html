<!DOCTYPE html> 
<html>
<head> 
		<title>OpenVPN scaling - Vacuum - Edward Vielmetti</title> 
	</head>
<body>


<h2>Vacuum weblog E. Vielmetti</h2>


<h3>
<a href="http://vielmetti.github.io/books/">books</a>
<a href="http://vielmetti.github.io/code/">code</a>
<a href="http://vielmetti.github.io/recipes/">recipes</a>
<a href="http://vielmetti.github.io/people/">people</a>
<a href="http://vielmetti.github.io/cities/">cities</a>
<a href="http://vielmetti.github.io/maps/">maps</a>
<a href="http://vielmetti.github.io/annarbor/">Ann Arbor</a>
<a href="http://vielmetti.github.io/categories/">categories</a>
<a href="http://vielmetti.github.io/keyphrases/">keyphrases</a>
</h3>




<h5>nature abhors a vacuum</h5>


<table>
<tr>
	

<td width="5%"></td>


<td width="30%" valign="top">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Vacuum weblog from Edward Vielmetti</h1>
      <p class="lead">
       Tracking the comings and goings of @vielmetti 
      </p>
    </div>

    <h3><a href="http://vielmetti.github.io/">Home</a> </h3>
    <ul class="sidebar-nav">
      
        <li><a href="http://vielmetti.github.io/post/2015/2015-07-14-publishing-from-hugo-to-github-pages/"> Publishing from Hugo to Github Pages </a></li>
      
    </ul>

    <h3 class="panel-title">Recent Posts</h3> 
    <ul class="sidebar-recent">
	 
	<li><a href="http://vielmetti.github.io/post/2016/2016-06-12-is-blogging-a-bad-idea/" class="list-group-item">Is blogging a bad idea?</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-06-01-github-private-repos/" class="list-group-item">Github private repositories</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-25-ann-arbor-writing-escapes/" class="list-group-item">Ann Arbor quiet writing escapes</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-25-a-commonplace-reader/" class="list-group-item">A commonplace reader</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-23-day-trips-from-ann-arbor/" class="list-group-item">Day trips from Ann Arbor</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-05-18-bots-are-hot/" class="list-group-item">Bots are hot - again</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-25-hidden-water-flush-maps/" class="list-group-item">Ann Arbor hydrant flushing maps</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-25-mdeq-flint-water-graphic/" class="list-group-item">Michigan DEQ with misleading graphic on progress in Flint Water Crisis</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-24-incomplete-image/" class="list-group-item">The incomplete image</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-24-mechanical-slaves/" class="list-group-item">Mechanical slaves and the Californian ideology</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-24-game-of-fail-hbonow-down/" class="list-group-item">Game of Fail - HBO Now unable to host Game of Thrones premiere</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-24-facebook-break/" class="list-group-item">Taking a break from Facebook</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-23-roos-roast-downtown/" class="list-group-item">Roos Roast to add downtown Ann Arbor location</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-22-washtenaw-restaraunt-inspections/" class="list-group-item">Washtenaw restaurant inspections</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-22-prince/" class="list-group-item">Prince</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-22-milnor-time/" class="list-group-item">Milnor Time at Mr. Stadium</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-17-ecuador-terremoto/" class="list-group-item">Earthquake in Ecuador, April 16, 2016</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-06-reluctance/" class="list-group-item">Reluctance</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-04-06-yo/" class="list-group-item">Yo</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-03-30-upgrade-to-el-capitan/" class="list-group-item">Upgrade to El Capitan</a></li>
        
    </ul>

    <div class="sidebar-calendar">
	
    </div>

    <div class="sidebar-todo">
	
    </div>

    <div class="sidebar-blogroll">
	
    </div>

    <p>&copy; 2016. All rights reserved. </p>
  </div>
</div>

</td>


<td width="5%" valign="top"></td>


<td width="55%" valign="top" halign="right">
		<h3>16 December 2015</h3>
		<h1>OpenVPN scaling</h1> 
		<p>Previously: <a href="http://vielmetti.github.io/post/2015/2015-11-20-openvpn-in-a-container/">OpenVPN in a container</a></p>

<p>Also previously: <a href="http://vielmetti.github.io/post/2015/2015-12-04-split-tunnels-considered-harmful/">Split tunnels considered harmful</a></p>

<p>I have this running in a staging environment and a test
environment; it properly isolates OpenVPN from the underlying
operating system, and seems to do the right thing performing
rather well. However, its biggest limitation is that
it runs on a single host &amp; thus provides neither
high availability in the case of Amazon <a href="http://vielmetti.github.io/post/2015/2015-09-20-aws-dynamodb-downtime-sunday-am/">funkiness</a>
nor scalability to handle lots of clients.</p>

<p>Getting this to be more reliable was a matter of tracking
down the right systemd configuration. I&rsquo;ll save systemd
commentary for a separate post, saying only that it&rsquo;s new,
it&rsquo;s not necessarily better for managing single machines,
but I can see the advantages for consolidated management of
big collections of machines.</p>

<p>Some OpenVPN config alternatives to pursue that look like they might do
the right thing are as follows:</p>

<p><a href="http://www.cloudcoreo.com">CloudCoreo</a> has a setup based on the Amazon Elastic Load Balancer.
They say</p>

<blockquote>
<p>Getting an OpenVPN config up and running in AWS is difficult. We&rsquo;ve already done it for you in an HA, durable, self-healing way. This blog post details how.</p>
</blockquote>

<p>The blog post is in two sections.
<a href="http://blog.cloudcoreo.com/single-points-of-failure-openvpn/">Part one</a> details how they
configured autoscaling, elastic load balancing, name service, S3
storage and policies, and security and IAM policies to set things
up the way that you would want them within Amazon&rsquo;s AWS.
<a href="http://blog.cloudcoreo.com/single-points-of-failure-openvpn-part-2-of-2/">Part two</a> goes on to describe the particular OpenVPN policy
and routing setup, and there&rsquo;s a bunch of policy there particularly
with the use of split tunnels that you want to understand.</p>

<p>Their claim that they have
&ldquo;done it all for you&rdquo; reflects a <a href="http://hub.cloudcoreo.com/stack/servers-vpn_c6a65">complete configuration</a> available
through their CloudCoreo system.</p>

<p>A second approach is detailed by <a href="https://blog.zalando.com">Zalando</a>, a Berlin based retail fashion platform.
Their article <a href="https://tech.zalando.com/blog/building-an-openvpn-cluster-zalando-style/">Building an OpenVPN Cluster, Zalando-Style</a>
uses dynamic routing to distribute routes, and the
<a href="http://www.nongnu.org/quagga/">Quagga</a> system as their software based router. This setup
does not particularly depend on AWS features, and they
claim that
&ldquo;With this set up, we have about 800 users (150 in parallel) and havenâ€™t faced any performance issues at anytime, from anywhere!&rdquo;
It&rsquo;s a bit more complex to set up, though the writeup
makes it clear that because of the flexibility that dynamic
routing gives you there&rsquo;s the opportunity to construct
firewall policies that follow the user quite independent
of how they are connecting to the network.</p>

<blockquote>
<p>A complex system that works is invariably found to have evolved from a simple system that worked. A complex system designed from scratch never works and cannot be patched up to make it work. You have to start over, beginning with a working simple system. (John Gall, Systemantics)</p>
</blockquote>
 
</td>


<td width="5%" valign="top"></td>

</tr>
</table>


<h3>Notes afterwards</h3>
	<p>
	Recreating more or less my original layout, but with 
	dynamically loaded content. I guess that could work!
	</p>
	<p>
<a title="Real Time Analytics" href="http://clicky.com/100880293"><img alt="Real Time Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100880293); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100880293ns.gif" /></p></noscript>
</p>

</body>
</html> 
