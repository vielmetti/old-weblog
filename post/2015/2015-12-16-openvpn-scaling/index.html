<!DOCTYPE html> 
<html>
<head> 
		<title>OpenVPN scaling - Vacuum - Edward Vielmetti</title> 
	</head>
<body>


<h2>Vacuum weblog E. Vielmetti</h2>


<h3>
<a href="http://vielmetti.github.io/books/">books</a>
<a href="http://vielmetti.github.io/code/">code</a>
<a href="http://vielmetti.github.io/recipes/">recipes</a>
<a href="http://vielmetti.github.io/people/">people</a>
<a href="http://vielmetti.github.io/cities/">cities</a>
<a href="http://vielmetti.github.io/maps/">maps</a>
<a href="http://vielmetti.github.io/annarbor/">Ann Arbor</a>
<a href="http://vielmetti.github.io/categories/">categories</a>
<a href="http://vielmetti.github.io/keyphrases/">keyphrases</a>
</h3>




<h5>nature abhors a vacuum</h5>


<table>
<tr>
	

<td width="5%"></td>


<td width="30%" valign="top">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Vacuum weblog from Edward Vielmetti</h1>
      <p class="lead">
       Tracking the comings and goings of @vielmetti 
      </p>
    </div>

    <h3><a href="http://vielmetti.github.io/">Home</a> </h3>
    <ul class="sidebar-nav">
      
        <li><a href="http://vielmetti.github.io/post/2015/2015-07-14-publishing-from-hugo-to-github-pages"> Publishing from Hugo to Github Pages </a></li>
      
    </ul>

    <h3 class="panel-title">Recent Posts</h3> 
    <ul class="sidebar-recent">
	 
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-14-aprs-network-status" class="list-group-item">Ann Arbor area APRS network status, January 2016</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-13-building-board-of-appeals-lacks-quorum-january-2016" class="list-group-item">January 2016 Ann Arbor Building Board of Appeals lacks a quorum</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-13-dave-new-n8sbe-sdr-at-arrow" class="list-group-item">Dave New N8SBE to speak at ARROW on Software Defined Radio</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-08-central-michigan-responds-to-morning-sun-wcmu-editorial" class="list-group-item">Central Michigan University spokesman responds to Morning Sun editorial regarding WCMU-TV spectrum auction</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-08-a2council-liquor-license-report" class="list-group-item">Ann Arbor City Council Liquor License Review Committee report, 8 January 2016</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-08-oxford-flood-network" class="list-group-item">Oxford Flood Network</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-07-dexter-fire-inverness-condo" class="list-group-item">Fire on Inverness in Dexter, Michigan</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-07-county-health-food-inspection-delays" class="list-group-item">Washtenaw County Health Department delays food inspection reporting from November 2015</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-06-cuts-coming-to-mlive" class="list-group-item">Cuts coming to MLive, 2016 edition; 29 content positions eliminated</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-06-wkar-television-spectrum-sale" class="list-group-item">WKAR-TV television spectrum may be up for sale, and the station is at risk</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-02-learning-morse-code" class="list-group-item">Learning Morse Code</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-01-qsl-card-template" class="list-group-item">QSL card template for Lob.com</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-22-kale-into-ice-cream" class="list-group-item">How I turned 99 cents worth of kale into half a gallon of delicious ice cream</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-21-mailchimp-form" class="list-group-item">Subscribe to a2b3 list through Mailchimp</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-18-a-visit-to-um-cvga" class="list-group-item">A visit to the Computer and Video Game Archive, @umcvga</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-17-santa-at-swedes-diner" class="list-group-item">Santa visiting Swede&#39;s Diner, Ann Arbor, December 1950</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-17-iot-platforms" class="list-group-item">Platforms for the Internet of Things, 2015 edition</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-16-douglas-vielmetti-plant-engineer" class="list-group-item">Douglas E. Vielmetti, plant engineer</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-16-openvpn-scaling" class="list-group-item">OpenVPN scaling</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-14-i-am-eating-a-sandwich-github-recipes" class="list-group-item">I am eating a sandwich, with a recipe in Github</a></li>
        
    </ul>

    <div class="sidebar-calendar">
	
    </div>

    <div class="sidebar-todo">
	
    </div>

    <div class="sidebar-blogroll">
	
    </div>

    <p>&copy; 2016. All rights reserved. </p>
  </div>
</div>

</td>


<td width="5%" valign="top"></td>


<td width="55%" valign="top" halign="right">
		<h3>16 December 2015</h3>
		<h1>OpenVPN scaling</h1> 
		<p>Previously: <a href="http://vielmetti.github.io/post/2015/2015-11-20-openvpn-in-a-container/">OpenVPN in a container</a></p>

<p>Also previously: <a href="http://vielmetti.github.io/post/2015/2015-12-04-split-tunnels-considered-harmful/">Split tunnels considered harmful</a></p>

<p>I have this running in a staging environment and a test
environment; it properly isolates OpenVPN from the underlying
operating system, and seems to do the right thing performing
rather well. However, its biggest limitation is that
it runs on a single host &amp; thus provides neither
high availability in the case of Amazon <a href="http://vielmetti.github.io/post/2015/2015-09-20-aws-dynamodb-downtime-sunday-am/">funkiness</a>
nor scalability to handle lots of clients.</p>

<p>Getting this to be more reliable was a matter of tracking
down the right systemd configuration. I&rsquo;ll save systemd
commentary for a separate post, saying only that it&rsquo;s new,
it&rsquo;s not necessarily better for managing single machines,
but I can see the advantages for consolidated management of
big collections of machines.</p>

<p>Some OpenVPN config alternatives to pursue that look like they might do
the right thing are as follows:</p>

<p><a href="http://www.cloudcoreo.com">CloudCoreo</a> has a setup based on the Amazon Elastic Load Balancer.
They say</p>

<blockquote>
<p>Getting an OpenVPN config up and running in AWS is difficult. We&rsquo;ve already done it for you in an HA, durable, self-healing way. This blog post details how.</p>
</blockquote>

<p>The blog post is in two sections.
<a href="http://blog.cloudcoreo.com/single-points-of-failure-openvpn/">Part one</a> details how they
configured autoscaling, elastic load balancing, name service, S3
storage and policies, and security and IAM policies to set things
up the way that you would want them within Amazon&rsquo;s AWS.
<a href="http://blog.cloudcoreo.com/single-points-of-failure-openvpn-part-2-of-2/">Part two</a> goes on to describe the particular OpenVPN policy
and routing setup, and there&rsquo;s a bunch of policy there particularly
with the use of split tunnels that you want to understand.</p>

<p>Their claim that they have
&ldquo;done it all for you&rdquo; reflects a <a href="http://hub.cloudcoreo.com/stack/servers-vpn_c6a65">complete configuration</a> available
through their CloudCoreo system.</p>

<p>A second approach is detailed by <a href="https://blog.zalando.com">Zalando</a>, a Berlin based retail fashion platform.
Their article <a href="https://tech.zalando.com/blog/building-an-openvpn-cluster-zalando-style/">Building an OpenVPN Cluster, Zalando-Style</a>
uses dynamic routing to distribute routes, and the
<a href="http://www.nongnu.org/quagga/">Quagga</a> system as their software based router. This setup
does not particularly depend on AWS features, and they
claim that
&ldquo;With this set up, we have about 800 users (150 in parallel) and havenâ€™t faced any performance issues at anytime, from anywhere!&rdquo;
It&rsquo;s a bit more complex to set up, though the writeup
makes it clear that because of the flexibility that dynamic
routing gives you there&rsquo;s the opportunity to construct
firewall policies that follow the user quite independent
of how they are connecting to the network.</p>

<blockquote>
<p>A complex system that works is invariably found to have evolved from a simple system that worked. A complex system designed from scratch never works and cannot be patched up to make it work. You have to start over, beginning with a working simple system. (John Gall, Systemantics)</p>
</blockquote>
 
</td>


<td width="5%" valign="top"></td>

</tr>
</table>


<h3>Notes afterwards</h3>
	<p>
	Recreating more or less my original layout, but with 
	dynamically loaded content. I guess that could work!
	</p>
	<p>
<a title="Real Time Analytics" href="http://clicky.com/100880293"><img alt="Real Time Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100880293); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100880293ns.gif" /></p></noscript>
</p>

</body>
</html> 
