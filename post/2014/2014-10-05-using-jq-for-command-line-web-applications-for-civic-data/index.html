<!DOCTYPE html> 
<html>
<head> 
		<title>using &#34;jq&#34; for command line web applications for civic data - Vacuum - Edward Vielmetti</title> 
	</head>
<body>


<h2>Vacuum weblog E. Vielmetti</h2>


<h3>
<a href="http://vielmetti.github.io/books/">books</a>
<a href="http://vielmetti.github.io/code/">code</a>
<a href="http://vielmetti.github.io/recipes/">recipes</a>
<a href="http://vielmetti.github.io/people/">people</a>
<a href="http://vielmetti.github.io/cities/">cities</a>
<a href="http://vielmetti.github.io/maps/">maps</a>
<a href="http://vielmetti.github.io/annarbor/">Ann Arbor</a>
<a href="http://vielmetti.github.io/categories/">categories</a>
<a href="http://vielmetti.github.io/keyphrases/">keyphrases</a>
</h3>




<h5>nature abhors a vacuum</h5>


<table>
<tr>
	

<td width="5%"></td>


<td width="30%" valign="top">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Vacuum weblog from Edward Vielmetti</h1>
      <p class="lead">
       Tracking the comings and goings of @vielmetti 
      </p>
    </div>

    <h3><a href="http://vielmetti.github.io/">Home</a> </h3>
    <ul class="sidebar-nav">
      
        <li><a href="http://vielmetti.github.io/post/2015/2015-07-14-publishing-from-hugo-to-github-pages"> Publishing from Hugo to Github Pages </a></li>
      
    </ul>

    <h3 class="panel-title">Recent Posts</h3> 
    <ul class="sidebar-recent">
	 
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-25-ann-arbor-public-schools-social-media-threat" class="list-group-item">Ann Arbor Public Schools respond to social media threat</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-24-alaska-earthquake" class="list-group-item">M7.1 earthquake felt in Anchorage, Alaska</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-22-writing-things-down" class="list-group-item">Writing things down</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-22-a2b3-lunch-nonsummary" class="list-group-item">a2b3 lunch non-summary for 3d week of January 2016</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-18-mlk-day-on-umich-campus" class="list-group-item">Some highlights of MLK Day 2016 on the U of Michigan campus</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-17-qso-on-redditnet" class="list-group-item">QSO on redditnet via Geekshed IRC</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-14-letterpress-qsl-cards" class="list-group-item">Letterpress QSL cards</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-14-aprs-network-status" class="list-group-item">Ann Arbor area APRS network status, January 2016</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-13-building-board-of-appeals-lacks-quorum-january-2016" class="list-group-item">January 2016 Ann Arbor Building Board of Appeals lacks a quorum</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-13-dave-new-n8sbe-sdr-at-arrow" class="list-group-item">Dave New N8SBE to speak at ARROW on Software Defined Radio</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-08-central-michigan-responds-to-morning-sun-wcmu-editorial" class="list-group-item">Central Michigan University spokesman responds to Morning Sun editorial regarding WCMU-TV spectrum auction</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-08-a2council-liquor-license-report" class="list-group-item">Ann Arbor City Council Liquor License Review Committee report, 8 January 2016</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-08-oxford-flood-network" class="list-group-item">Oxford Flood Network</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-07-dexter-fire-inverness-condo" class="list-group-item">Fire on Inverness in Dexter, Michigan</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-07-county-health-food-inspection-delays" class="list-group-item">Washtenaw County Health Department delays food inspection reporting from November 2015</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-06-cuts-coming-to-mlive" class="list-group-item">Cuts coming to MLive, 2016 edition; 29 content positions eliminated</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-06-wkar-television-spectrum-sale" class="list-group-item">WKAR-TV television spectrum may be up for sale, and the station is at risk</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-02-learning-morse-code" class="list-group-item">Learning Morse Code</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2016/2016-01-01-qsl-card-template" class="list-group-item">QSL card template for Lob.com</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-12-22-kale-into-ice-cream" class="list-group-item">How I turned 99 cents worth of kale into half a gallon of delicious ice cream</a></li>
        
    </ul>

    <div class="sidebar-calendar">
	
    </div>

    <div class="sidebar-todo">
	
    </div>

    <div class="sidebar-blogroll">
	
    </div>

    <p>&copy; 2016. All rights reserved. </p>
  </div>
</div>

</td>


<td width="5%" valign="top"></td>


<td width="55%" valign="top" halign="right">
		<h3>5 October 2014</h3>
		<h1>using &#34;jq&#34; for command line web applications for civic data</h1> 
		<p>One of the tools that I rediscovered and have been really happy for
having done so is &ldquo;jq&rdquo;, a command line tool that bills itself as
&ldquo;awk for json&rdquo;.</p>

<p>I&rsquo;ve been writing awk code since 1985, and some limited subset
of it is something that I know really, really well. awk, however,
is from the punchcard era, and as such it likes to deal with records
that are all on one line each. Parsing JSON in awk is very clumsy
and ad hoc and really doesn&rsquo;t work all that well. Since most Internet
APIs these days have some kind of JSON encoding, it means that you
can&rsquo;t simply dash off an awk one-liner to consume and transform
Internet input data.</p>

<p>jq fixes that situation. Here for example is a one line renderings of a common task I look to solve with municipal data as a test of any new tool development: analysis of parking data. This code sample prints the total number of open spaces in the Ann Arbor Downtown Development Authority&rsquo;s garages:</p>

<blockquote>
  <p>curl -s http://www.a2dda.org/map/AADDACount.json |
  jq "[.countdata[].spacesavail | tonumber] | add" </p>
</blockquote>

<p>I&rsquo;m not going to try to explain how jq works, except to note that
it&rsquo;s constructed in order to be a filter: data comes in one JSON
object at a time, and the script iterates over them, transforming
them in some way and then passing JSON out the other end. This makes
it perfect for ad hoc Unix pipeline efforts where you&rsquo;re chipping
away at a data set trying to make sense of it by successively
refining it as you go.</p>

<p>I&rsquo;ve built jq pipelines for this Ann Arbor parking data, for AAATA
bus system data, and for the Marquette Park Cemetery data. The
parking data is straightforward, since it exits the system as JSON.
Bus system data is only incrementally harder; it started either as
HTML or as XML, and for that you want to use &ldquo;tidy&rdquo; and &ldquo;xml2json&rdquo;
in your pipeline. The Park Cemetery data set started as JSON via
the Socrata SODA API, but I needed little bits of &ldquo;sed&rdquo; and &ldquo;perl&rdquo;
to smooth out some rough edges in the source data; it really wants
to end up as GeoJSON when I&rsquo;m done, but it isn&rsquo;t there quite yet.</p>

<p>Shell programming is my favorite programming environment. Any time
I can take a set of well-understood tools and crunch through big
data sets with only a few lines of code, I&rsquo;m happy. The challenge
of shell programming is that it&rsquo;s full of opportunities to get
things just a little bit wrong with parsing; by making JSON the
data format that&rsquo;s shoveled between programs rather than a flat
one-record-per-line text format, you open up the opportunity for
pulling apart rather complex structures and manipulating them with
hardly any work.</p>

<p>For further reading, see Jeroen Janssens new book <a
href="http://datascienceatthecommandline.com/">Data Science at the
Command Line</a> which works you way through dozens of tools like
this that can help manage big data without big programs.</p>
 
</td>


<td width="5%" valign="top"></td>

</tr>
</table>


<h3>Notes afterwards</h3>
	<p>
	Recreating more or less my original layout, but with 
	dynamically loaded content. I guess that could work!
	</p>
	<p>
<a title="Real Time Analytics" href="http://clicky.com/100880293"><img alt="Real Time Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100880293); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100880293ns.gif" /></p></noscript>
</p>

</body>
</html> 
