<!DOCTYPE html> 
<html>
<body>
<title>Vacuum</title>


<h2>Vacuum weblog E. Vielmetti</h2>


<h3>
<a href="http://vielmetti.github.io/books/">books</a>
music
jobs
<a href="http://vielmetti.github.io/recipes/">recipes</a>
<a href="http://vielmetti.github.io/people/">people</a>
<a href="http://vielmetti.github.io/cities/">cities</a>
<a href="http://vielmetti.github.io/maps/">maps</a>
networks
</h3>




<h5>nature abhors a vacuum</h5>


<table>
<tr>
	

<td width="5%"></td>


<td width="30%" valign="top">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>tracker</h1>
      <p class="lead">
       Tracking the comings and goings of @vielmetti 
      </p>
    </div>

    <h3><a href="http://vielmetti.github.io/">Home</a> </h3>
    <ul class="sidebar-nav">
      
        <li><a href="http://vielmetti.github.io/post/2015/2015-07-14-publishing-from-hugo-to-github-pages"> Publishing from Hugo to Github Pages </a></li>
      
    </ul>

    <h3 class="panel-title">Recent Posts</h3> 
    <ul class="sidebar-recent">
	 
	<li><a href="http://vielmetti.github.io/post/2015-07-16-custom-views-of-taxonomies" class="list-group-item">custom views of taxonomies</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-16-a2b3-lunch-at-ayses" class="list-group-item">a2b3 lunch at Ayse&#39;s, Art Fair 2015 edition</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-15-diligently-editing-and-converting-for-production" class="list-group-item">diligently editing and converting for production</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-14-a-great-many-things" class="list-group-item">a great many things</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-14-the-hugo-cookbook" class="list-group-item">the hugo cookbook</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-14-sweet-potato-cauliflower-soup" class="list-group-item">sweet potato cauliflower soup recipe</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-14-publishing-from-hugo-to-github-pages" class="list-group-item">Publishing from Hugo to Github Pages</a></li>
         
	<li><a href="http://vielmetti.github.io/post/Mac-and-Goat" class="list-group-item">Mac and Goat</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-14-customizing-a-theme" class="list-group-item">customizing a theme</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-14-converting-typepad-to-hugo" class="list-group-item">converting typepad to hugo</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-14-lunch-with-jonathan" class="list-group-item">lunch with jonathan</a></li>
         
	<li><a href="http://vielmetti.github.io/post/wow-that-is-fast" class="list-group-item">wow that is fast</a></li>
         
	<li><a href="http://vielmetti.github.io/sidebar/calendar" class="list-group-item">Calendar of events</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-13-bringing-up-node-red-and-mosquitto-under-docker-compose-on-a-raspberry-pi" class="list-group-item">Bringing up Node-RED and mosquitto under &#34;docker compose&#34; on a Raspberry Pi</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-11-gooseberries-at-ann-arbor-farmers-market" class="list-group-item">gooseberries at Ann Arbor Farmers Market</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-06-ann-arbor-city-council-for-july-6-2015-online-video-stream-goes-dark" class="list-group-item">Ann Arbor City Council for July 6, 2015: online video stream goes dark</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-06-the-verge-turns-off-comments" class="list-group-item">The Verge turns off comments</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-07-03-reddit-is-going-up-in-flames" class="list-group-item">&#34;Reddit is going up in flames&#34;</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-06-29-never-read-the-comments" class="list-group-item">Never read the comments</a></li>
         
	<li><a href="http://vielmetti.github.io/post/2015/2015-06-29-bbc-greeces-bank-holiday-from-hell-impact-on-bitcoin-transactions" class="list-group-item">BBC: &#34;Greece&#39;s bank holiday from hell&#34;; impact on Bitcoin transactions?</a></li>
        
    </ul>

    <div class="sidebar-calendar">
	
    </div>


    <p>&copy; 2015. All rights reserved. </p>
  </div>
</div>

</td>


<td width="5%" valign="top"></td>


<td width="55%" valign="top" halign="right">
		<title>using &#34;jq&#34; for command line web applications for civic data</title> 
	</head> 
	<body> 
		<h3>5 October 2014</h3>
		<h1>using &#34;jq&#34; for command line web applications for civic data</h1> 
		<p>One of the tools that I rediscovered and have been really happy for having done so is "jq", a command line tool that bills itself as "awk for json". </p>

<p>I've been writing awk code since 1985, and some limited subset of it is something that I know really, really well. awk, however, is from the punchcard era, and as such it likes to deal with records that are all on one line each. Parsing JSON in awk is very clumsy and ad hoc and really doesn't work all that well. Since most Internet APIs these days have some kind of JSON encoding, it means that you can't simply dash off an awk one-liner to consume and transform Internet input data.</p>

<p>jq fixes that situation. Here for example is a one line renderings of a common task I look to solve with municipal data as a test of any new tool development: analysis of parking data. This code sample prints the total number of open spaces in the Ann Arbor Downtown Development Authority's garages:</p>

<blockquote>
  <p>curl -s http://www.a2dda.org/map/AADDACount.json |
  jq "[.countdata[].spacesavail | tonumber] | add" </p>
</blockquote>

<p>I'm not going to try to explain how jq works, except to note that it's constructed in order to be a filter: data comes in one JSON object at a time, and the script iterates over them, transforming them in some way and then passing JSON out the other end. This makes it perfect for ad hoc Unix pipeline efforts where you're chipping away at a data set trying to make sense of it by successively refining it as you go.</p>

<p>I've built jq pipelines for this Ann Arbor parking data, for AAATA bus system data, and for the Marquette Park Cemetery data. The parking data is straightforward, since it exits the system as JSON. Bus system data is only incrementally harder; it started either as HTML or as XML, and for that you want to use "tidy" and "xml2json" in your pipeline. The Park Cemetery data set started as JSON via the Socrata SODA API, but I needed little bits of "sed" and "perl" to smooth out some rough edges in the source data; it really wants to end up as GeoJSON when I'm done, but it isn't there quite yet.</p>

<p>Shell programming is my favorite programming environment. Any time I can take a set of well-understood tools and crunch through big data sets with only a few lines of code, I'm happy. The challenge of shell programming is that it's full of opportunities to get things just a little bit wrong with parsing; by making JSON the data format that's shoveled between programs rather than a flat one-record-per-line text format, you open up the opportunity for pulling apart rather complex structures and manipulating them with hardly any work.</p>

<p>For further reading, see Jeroen Janssens new book <a href="http://datascienceatthecommandline.com/">Data Science at the Command Line</a> which works you way through dozens of tools like this that can help manage big data without big programs.</p>
 
	</body> 
</td>


<td width="5%" valign="top"></td>

</tr>
</table>


<h3>Notes afterwards</h3>
	<p>
	Recreating more or less my original layout, but with 
	dynamically loaded content. I guess that could work!
	</p>

</body>
</html> 
